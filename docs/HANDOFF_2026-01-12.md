# Handoff — 2026-01-12

## Сессия

### Knowledge Item: Hybrid Intent Detection
Создана KI для паттерна гибридного распознавания интентов:

```
/knowledge/hybrid_intent_detection/
├── metadata.json
└── artifacts/
    ├── overview.md              # 3-tier architecture
    ├── implementation_patterns.md  # Code examples
    └── confidence_scoring.md    # Scoring algorithm
```

**Паттерн:** Regex ≥80% → LLM 50-79% → Chat <50%

### System Prompt V2
Создан `system-prompt-v2.md` — полный редизайн промпта для BIP Buddy:

- **Role:** Стратегический партнёр + тактический советник (не коуч)
- **Context:** Shotgun-фаза, 30-45 мин/день на контент
- **Philosophy:** Shotgun-to-Sniper как система поиска PMF
- **Tactics:** Ежедневно/еженедельно/ежемесячно breakdown
- **Signals:** Сильные vs слабые сигналы для решения о фокусе
- **Modes:** Тактика / Стратегия / Фидбек / Анализ

## Файлы

| Файл | Статус |
|------|--------|
| `system-prompt-v2.md` | NEW — промпт v2 |
| `/knowledge/hybrid_intent_detection/` | NEW — KI |

## Known Issues (из прошлого handoff)

- [ ] Empty catch blocks в `routes/chat.js` (lines 40, 108, 119)
- [ ] `type` vs `intentType` inconsistency

## Следующие шаги

1. **Интегрировать system-prompt-v2** в `prompt-builder.js`
2. **Fix minor issues** — catch blocks + naming
3. **Test new prompt** — E2E с разными сценариями

---

## Сессия 2: User Context Onboarding ✅

### Имплементация завершена

Реализован User Context Onboarding Wizard по паттерну `soul-onboarding.js`.

#### Решения:
- **Test infrastructure:** Нативные тесты (no Jest)
- **Endpoint location:** Отдельный `routes/user.js` (separation of concerns)

#### Созданные файлы:

| Файл | Статус | Описание |
|------|--------|----------|
| `hub/data/user-context.json` | ✅ | JSON template |
| `hub/routes/user.js` | ✅ | GET/POST `/api/user-context` |
| `hub/user-onboarding.js` | ✅ NEW | 530 lines, 8-step wizard |
| `hub/user-onboarding.css` | ✅ NEW | 500 lines, glassmorphism |
| `hub/index.html` | ✅ MOD | CSS/JS includes |
| `hub/server.js` | ✅ MOD | userRoutes mount |
| `hub/app.js` | ✅ MOD | auto-trigger on DOMContentLoaded |

#### Wizard Steps:
1. **Intro** — Welcome + feature preview
2. **Phase** — Shotgun / Sniper / Exploring
3. **Projects** — Add projects with status (idea/building/live)
4. **Platforms** — Twitter, Telegram, etc + follower count
5. **Skills** — Developer, AI Creator, Video, Writer, etc
6. **Time** — 15/30/45/60+ min per day
7. **Goals** — Discipline, Networking, Sales, PMF, etc
8. **Preview** — Summary + language selection + save

### E2E Verification ✅

- Wizard auto-triggers при `onboarded: false`
- Все 8 шагов работают корректно
- UI рендерится с glassmorphism styling
- Навигация Back/Next работает
- Server перезапущен с новыми routes

### Следующие шаги

1. **Prompt Integration:**
   - [ ] Модифицировать `buildSystemPrompt()` для загрузки `user-context.json`
   - [ ] Построение `<user_context>` секции динамически из wizard data

2. **Known Issues (из прошлого handoff):**
   - [ ] Empty catch blocks в `routes/chat.js`
   - [ ] `type` vs `intentType` inconsistency

