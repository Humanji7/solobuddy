# Handoff ‚Äî 2026-01-12

## –°–µ—Å—Å–∏—è

### Knowledge Item: Hybrid Intent Detection
–°–æ–∑–¥–∞–Ω–∞ KI –¥–ª—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∏–Ω—Ç–µ–Ω—Ç–æ–≤:

```
/knowledge/hybrid_intent_detection/
‚îú‚îÄ‚îÄ metadata.json
‚îî‚îÄ‚îÄ artifacts/
    ‚îú‚îÄ‚îÄ overview.md              # 3-tier architecture
    ‚îú‚îÄ‚îÄ implementation_patterns.md  # Code examples
    ‚îî‚îÄ‚îÄ confidence_scoring.md    # Scoring algorithm
```

**–ü–∞—Ç—Ç–µ—Ä–Ω:** Regex ‚â•80% ‚Üí LLM 50-79% ‚Üí Chat <50%

### System Prompt V2
–°–æ–∑–¥–∞–Ω `system-prompt-v2.md` ‚Äî –ø–æ–ª–Ω—ã–π —Ä–µ–¥–∏–∑–∞–π–Ω –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è BIP Buddy:

- **Role:** –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Ç–Ω—ë—Ä + —Ç–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å–æ–≤–µ—Ç–Ω–∏–∫ (–Ω–µ –∫–æ—É—á)
- **Context:** Shotgun-—Ñ–∞–∑–∞, 30-45 –º–∏–Ω/–¥–µ–Ω—å –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç
- **Philosophy:** Shotgun-to-Sniper –∫–∞–∫ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ PMF
- **Tactics:** –ï–∂–µ–¥–Ω–µ–≤–Ω–æ/–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ/–µ–∂–µ–º–µ—Å—è—á–Ω–æ breakdown
- **Signals:** –°–∏–ª—å–Ω—ã–µ vs —Å–ª–∞–±—ã–µ —Å–∏–≥–Ω–∞–ª—ã –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –æ —Ñ–æ–∫—É—Å–µ
- **Modes:** –¢–∞–∫—Ç–∏–∫–∞ / –°—Ç—Ä–∞—Ç–µ–≥–∏—è / –§–∏–¥–±–µ–∫ / –ê–Ω–∞–ª–∏–∑

## –§–∞–π–ª—ã

| –§–∞–π–ª | –°—Ç–∞—Ç—É—Å |
|------|--------|
| `system-prompt-v2.md` | NEW ‚Äî –ø—Ä–æ–º–ø—Ç v2 |
| `/knowledge/hybrid_intent_detection/` | NEW ‚Äî KI |

## Known Issues (–∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ handoff)

- [ ] Empty catch blocks –≤ `routes/chat.js` (lines 40, 108, 119)
- [ ] `type` vs `intentType` inconsistency

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å system-prompt-v2** –≤ `prompt-builder.js`
2. **Fix minor issues** ‚Äî catch blocks + naming
3. **Test new prompt** ‚Äî E2E —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏

---

## –°–µ—Å—Å–∏—è 2: User Context Onboarding ‚úÖ

### –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω User Context Onboarding Wizard –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É `soul-onboarding.js`.

#### –†–µ—à–µ–Ω–∏—è:
- **Test infrastructure:** –ù–∞—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã (no Jest)
- **Endpoint location:** –û—Ç–¥–µ–ª—å–Ω—ã–π `routes/user.js` (separation of concerns)

#### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

| –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------|----------|
| `hub/data/user-context.json` | ‚úÖ | JSON template |
| `hub/routes/user.js` | ‚úÖ | GET/POST `/api/user-context` |
| `hub/user-onboarding.js` | ‚úÖ NEW | 530 lines, 8-step wizard |
| `hub/user-onboarding.css` | ‚úÖ NEW | 500 lines, glassmorphism |
| `hub/index.html` | ‚úÖ MOD | CSS/JS includes |
| `hub/server.js` | ‚úÖ MOD | userRoutes mount |
| `hub/app.js` | ‚úÖ MOD | auto-trigger on DOMContentLoaded |

#### Wizard Steps:
1. **Intro** ‚Äî Welcome + feature preview
2. **Phase** ‚Äî Shotgun / Sniper / Exploring
3. **Projects** ‚Äî Add projects with status (idea/building/live)
4. **Platforms** ‚Äî Twitter, Telegram, etc + follower count
5. **Skills** ‚Äî Developer, AI Creator, Video, Writer, etc
6. **Time** ‚Äî 15/30/45/60+ min per day
7. **Goals** ‚Äî Discipline, Networking, Sales, PMF, etc
8. **Preview** ‚Äî Summary + language selection + save

### E2E Verification ‚úÖ

- Wizard auto-triggers –ø—Ä–∏ `onboarded: false`
- –í—Å–µ 8 —à–∞–≥–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- UI —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è —Å glassmorphism styling
- –ù–∞–≤–∏–≥–∞—Ü–∏—è Back/Next —Ä–∞–±–æ—Ç–∞–µ—Ç
- Server –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —Å –Ω–æ–≤—ã–º–∏ routes

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **Prompt Integration:**
   - [x] –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `buildSystemPrompt()` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ `user-context.json`
   - [x] –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ `<user_context>` —Å–µ–∫—Ü–∏–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ wizard data

2. **Known Issues (–∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ handoff):**
   - [ ] Empty catch blocks –≤ `routes/chat.js`
   - [ ] `type` vs `intentType` inconsistency

---

## –°–µ—Å—Å–∏—è 3: System Prompt V2 Integration ‚úÖ

### –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞

–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω `system-prompt-v2.md` –≤ `prompt-builder.js` —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π user context –∏–∑ onboarding wizard.

#### –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

| –§—É–Ω–∫—Ü–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|-----------|
| `loadUserContext()` | –ó–∞–≥—Ä—É–∂–∞–µ—Ç `user-context.json` –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `onboarded: true` |
| `buildUserContextSection()` | –°—Ç—Ä–æ–∏—Ç `<user_context>` —Å–µ–∫—Ü–∏—é –∏–∑ wizard data —Å –º–∞–ø–ø–∏–Ω–≥–æ–º –ø–æ–ª–µ–π |
| `buildSystemPromptV2()` | **ASYNC** ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ—Ç `system-prompt-v2.md`, –∑–∞–º–µ–Ω—è–µ—Ç `<user_context>`, –¥–æ–±–∞–≤–ª—è–µ—Ç language enforcement |

#### –ú–∞–ø–ø–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö wizard ‚Üí prompt:

- **Phase:** `shotgun/sniper/exploring` ‚Üí –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–∑—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- **Projects:** –º–∞—Å—Å–∏–≤ —Å `name` + `status` ‚Üí "–ø—Ä–æ–µ–∫—Ç1 (‚úÖ live), –ø—Ä–æ–µ–∫—Ç2 (üîß building)"
- **Platforms:** –º–∞—Å—Å–∏–≤ —Å `id` + `followers` ‚Üí "Twitter (4), Telegram (20)"
- **Skills:** `ai_creator`, `developer` –∏ —Ç.–¥. ‚Üí —Ä—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è
- **Time:** `timePerDay` ‚Üí "45 –º–∏–Ω—É—Ç –≤ –¥–µ–Ω—å –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç"
- **Goals:** `discipline`, `networking`, `sales` ‚Üí "–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –ø—É–±–ª–∏—á–Ω–æ—Å—Ç–∏ ‚Üí –Ω–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥ ‚Üí –ø—Ä–æ–¥–∞–∂–∏"
- **Language:** `ru`/`en` ‚Üí "—Ä—É—Å—Å–∫–∏–π" / "English"

#### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

| –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|--------|-----------|
| `hub/prompt-builder.js` | ‚úÖ MOD | +120 lines: 3 –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ + updated exports |

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ V2:

```
buildSystemPromptV2(options)
  ‚Üì
1. –ó–∞–≥—Ä—É–∑–∏—Ç—å system-prompt-v2.md –∫–∞–∫ template
2. –ó–∞–≥—Ä—É–∑–∏—Ç—å user-context.json (–µ—Å–ª–∏ onboarded: true)
3. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å <user_context> —á–µ—Ä–µ–∑ buildUserContextSection()
4. –ó–∞–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π <user_context> –≤ template –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π
5. –î–æ–±–∞–≤–∏—Ç—å language enforcement (detect –∏–∑ userMessage)
6. –í–µ—Ä–Ω—É—Ç—å –ø–æ–ª–Ω—ã–π –ø—Ä–æ–º–ø—Ç
```

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **Integration into chat-api.js:**
   - [ ] –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å `chat-api.js` –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `buildSystemPromptV2()` –≤–º–µ—Å—Ç–æ `buildSystemPrompt()`
   - [ ] –ü–µ—Ä–µ–¥–∞—Ç—å `userMessage` –≤ –æ–ø—Ü–∏—è—Ö –¥–ª—è language detection

2. **E2E Testing:**
   - [ ] –¢–µ—Å—Ç "–Ω–æ–≤—ã–π —é–∑–µ—Ä" ‚Üí wizard ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–º–ø—Ç–∞
   - [ ] –¢–µ—Å—Ç —Ä–∞–∑–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π wizard data
   - [ ] –¢–µ—Å—Ç language detection (ru/en —Å–æ–æ–±—â–µ–Ω–∏—è)

3. **Known Issues (–∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ handoff):**
   - [ ] Empty catch blocks –≤ `routes/chat.js`
   - [ ] `type` vs `intentType` inconsistency

---

## Known Issue: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞
Regex-—Ç—Ä–∏–≥–≥–µ—Ä—ã —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–æ—á–Ω—ã–µ/–±–ª–∏–∑–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã, –Ω–µ –ø–æ–∫—Ä—ã–≤–∞—è –≤—Å—ë –±–æ–≥–∞—Ç—Å—Ç–≤–æ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞. –ü—Ä–∏–º–µ—Ä: —Ç—Ä–∏–≥–≥–µ—Ä "–¥–∞–π –∏–¥–µ—é" –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ "–ø–æ–¥–∫–∏–Ω—å —Ç–µ–º—É" –∏–ª–∏ "–Ω—É–∂–µ–Ω –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ —Å–µ–≥–æ–¥–Ω—è".

### –†–µ—à–µ–Ω–∏–µ
–ü–æ–¥–∫–ª—é—á–∏—Ç—å LLM –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤:

1. **Tier 0 ‚Äî Fast Regex:** –¢–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (‚â•90% confidence) ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
2. **Tier 1 ‚Äî LLM Intent Classification:** –ï—Å–ª–∏ regex –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª ‚Üí –±—ã—Å—Ç—Ä—ã–π LLM-–≤—ã–∑–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–Ω—Ç–µ–Ω—Ç–∞
3. **Fallback:** –ï—Å–ª–∏ LLM –Ω–µ —É–≤–µ—Ä–µ–Ω ‚Üí –æ–±—ã—á–Ω—ã–π chat flow

### –í–∞—Ä–∏–∞–Ω—Ç—ã –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏

**A) –†–∞—Å—à–∏—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `llm-intent-classifier.js`:**
- –î–æ–±–∞–≤–∏—Ç—å trigger-specific intents –≤ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- –ú–∞–ø–ø–∏–Ω–≥: `intent ‚Üí trigger handler`

**B) –û—Ç–¥–µ–ª—å–Ω—ã–π trigger resolver:**
- –ú–∏–∫—Ä–æ-–ø—Ä–æ–º–ø—Ç: "–≠—Ç–æ –∑–∞–ø—Ä–æ—Å –Ω–∞ [–∏–¥–µ—é/—Ñ–∏–¥–±–µ–∫/–∞–Ω–∞–ª–∏–∑/etc]?"
- –ë—ã—Å—Ç—Ä—ã–π –≤—ã–∑–æ–≤ —Å –Ω–∏–∑–∫–∏–º `max_tokens`

**C) Embeddings + similarity search:**
- Pre-computed embeddings –¥–ª—è canonical trigger phrases
- Cosine similarity –¥–ª—è –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- Threshold-based matching

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç
–°—Ä–µ–¥–Ω–∏–π ‚Äî —Ç–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–µ–π—Å–æ–≤, –Ω–æ —Ç–µ—Ä—è–µ—Ç edge cases.

